<%= link_to new_app_conversation_path(@app.key), 
	class: "navigator-item", 
	data: {turbo_frame: "modal"} do %>
	<svg class="text-lg mr-3 h-6 w-6 dark:text-gray-100 text-gray-500 group-hover:text-gray-500 group-focus:text-gray-600 transition ease-in-out duration-150" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
	<%= t("conversations.menu.compose") %>
<% end %>

<%= link_to app_conversations_path(@app.key), class: "navigator-item" do %>
	<div class="text-lg mr-3 h-6 w-6 dark:text-gray-100 text-gray-500 group-hover:text-gray-500 group-focus:text-gray-600 transition ease-in-out duration-150">
		<svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="22" height="22">
				<path d="M3.5 11.493H4v-.5h-.5v.5zm0 2.998H3a.5.5 0 00.8.4l-.3-.4zm4-2.998v-.5h-.167l-.133.1.3.4zm-3-7.496H4v1h.5v-1zm6 1h.5v-1h-.5v1zm-6 1.998H4v1h.5v-1zm4 1H9v-1h-.5v1zM3 11.493v2.998h1v-2.998H3zm.8 3.398l4-2.998-.6-.8-4 2.998.6.8zm3.7-2.898h6v-1h-6v1zm6 0c.829 0 1.5-.67 1.5-1.5h-1c0 .277-.223.5-.5.5v1zm1.5-1.5V1.5h-1v8.994h1zM15 1.5c0-.83-.671-1.5-1.5-1.5v1c.277 0 .5.223.5.5h1zM13.5 0h-12v1h12V0zm-12 0C.671 0 0 .67 0 1.5h1c0-.277.223-.5.5-.5V0zM0 1.5v8.993h1V1.5H0zm0 8.993c0 .83.671 1.5 1.5 1.5v-1a.499.499 0 01-.5-.5H0zm1.5 1.5h2v-1h-2v1zm3-6.996h6v-1h-6v1zm0 2.998h4v-1h-4v1z" fill="currentColor"></path>
		</svg>
	</div>
	<%= t("conversations.menu.conversations") %>
<% end %>

<%= link_to app_assignment_rules_path(@app.key),
	data: {turbo_frame: "conversation", turbo_action: "advance"},
	class: "navigator-item" do %>
	<div class="text-lg mr-3 h-6 w-6 dark:text-gray-100 text-gray-500 group-hover:text-gray-500 group-focus:text-gray-600 transition ease-in-out duration-150">
		<svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="22" height="22">
				<path d="M2.5 1.5a1 1 0 11-2 0 1 1 0 012 0zm0 0h2a3 3 0 013 3v6a3 3 0 003 3h2m0 0a1 1 0 102 0 1 1 0 00-2 0z" stroke="currentColor"></path>
		</svg>
	</div>
	<%= t("conversations.menu.assignment_rules") %>		
<% end %>

<div>
		<div class="mt-4 flex items-center flex-shrink-0 px-4 text-md leading-6 font-bold text-gray-900 dark:text-gray-100">
			<h3 class="font-bold">
				<%= t("conversations.menu.conversations") %>
			</h3>
		</div>

		<% @app.conversations.group("assignee_id").count.each do |k,v| %>
			
			<% if k.present? %>
				<% user = @app.agents.find_by(id: k) %>
				<% next if user.blank?%>
			<% else %>
				<% user = nil %>
			<% end %>

			<%= link_to "a", data: { 
				controller: "attribute-clone", 
				clone_to: "#conversation_search_service_agent_id", 
				action: "click->attribute-clone#prevent" 
			}  do %>

				<%= radio_button_tag 'conversation_search_service[agent_id]', user&.id, user&.id == @search_service.agent_id,
					class: "hidden",
					id: "conversation_search_service_channel_id_all" ,
					data: {
						attribute_clone_target: "radio"
					}
				%>

				<div class="navigator-item">
					<% #= [k , user&.id , @search_service.agent_id] %>
					<% if user.present? %>
						<div class="flex-shrink-0 -ml-1 mr-3 h-6 w-6 text-gray-400 group-focus:text-gray-500 transition ease-in-out duration-150">
							<span class="inline-block relative">
								<%= image_tag user.avatar_url , class:"h-6 w-6 rounded-full bg-white "%>
							</span>
						</div>
						<span class="truncate">
							<%= user.display_name || user.email %>
						</span>
					
					<% else %>
		
						<svg class="w-5 mr-3" 
							viewBox="0 0 15 15" 
							fill="none" xmlns="http://www.w3.org/2000/svg" 
							width="15" 
							height="15">
							<path 
								d="M.5 12.5v-10a1 1 0 011-1h4l2 2h6a1 1 0 011 1v8a1 1 0 01-1 1h-12a1 1 0 01-1-1z" 
								stroke="currentColor">
							</path>
						</svg>

						<span class="truncate"><%= t("conversations.menu.unassigned") %></span>
					<% end %>

					<span class="ml-auto inline-block py-0.5 px-3 text-xs leading-4 rounded-full text-gray-600 bg-gray-200 group-hover:bg-gray-200 group-focus:bg-gray-300 transition ease-in-out duration-150">
						<%= v %>
					</span>
				</div>

			<% end %>
		
		<% end %>

		<%= link_to "a", data: { 
				controller: "attribute-clone", 
				clone_to: "#conversation_search_service_agent_id", 
				action: "click->attribute-clone#prevent" 
			}  do %>

			<%= radio_button_tag 'conversation_search_service[agent_id]', "", @search_service.agent_id.blank?,
				class: "hidden",
				id: "conversation_search_service_channel_id_all" ,
				data: {
					attribute_clone_target: "radio"
				}
			%>

			<div class="navigator-item">
				<svg 
					class="w-4mr-2"
					viewBox="0 0 15 15" 
					fill="none" xmlns="http://www.w3.org/2000/svg" 
					width="15" 
					height="15">
					<path d="M3.5 8.5v-7a1 1 0 011-1h3l2 2h4a1 1 0 011 1v5a1 1 0 01-1 1h-9m-1-1a1 1 0 001 1m-1-1v-3h-2a1 1 0 00-1 1v7a1 1 0 001 1h9a1 1 0 001-1v-4h-7" stroke="currentColor">
					</path>
				</svg>
				<span class="truncate">
					<%= t("conversations.menu.all") %>
				</span>
				<span class="ml-auto inline-block py-0.5 px-3 text-xs leading-4 rounded-full text-gray-600 bg-gray-200 group-hover:bg-gray-200 group-focus:bg-gray-300 transition ease-in-out duration-150">
					<%= @app.conversations.size %>
				</span>
			</div>
		
		<% end %>

		<div class="mt-4 flex items-center flex-shrink-0 px-4 text-md leading-6 font-bold text-gray-900 dark:text-gray-200">
			<h3 class="font-bold">
				<%= t("conversations.menu.tags") %>
			</h3>
		</div>

		<% @app.conversations.tag_counts.each do |tag| %>

			<%= link_to "a", data: { 
					controller: "attribute-clone", 
					clone_to: "#conversation_search_service_tag", 
					action: "click->attribute-clone#prevent" 
				}  do %>

				<%= radio_button_tag 'conversation_search_service[tag_id]', tag.name, @search_service.tag == tag.name,
					class: "hidden",
					id: "conversation_search_service_channel_id_#{tag.name}" ,
					data: {
						attribute_clone_target: "radio"
					}
				%>

				<div class="navigator-item">
					<svg 
						style="<%= "color:#{@app.tag_list.find{|o| o["name"] == tag.name}&.dig('color') }" %>"
						viewBox="0 0 15 15"
						class="mr-3"
						fill="none" xmlns="http://www.w3.org/2000/svg" 
						width="15" 
						height="15">
						<path d="M10 4.5a.5.5 0 111 0 .5.5 0 01-1 0z" fill="currentColor"></path>
						<path fill-rule="evenodd" clip-rule="evenodd" d="M7.146.146A.5.5 0 017.5 0h6A1.5 1.5 0 0115 1.5v6a.5.5 0 01-.146.354l-7 7a.5.5 0 01-.708 0l-7-7a.5.5 0 010-.708l7-7zM10.5 3a1.5 1.5 0 100 3 1.5 1.5 0 000-3z" fill="currentColor">
						</path>
					</svg>

					<span class="truncate">
						<%= tag.name %>
					</span>
					<span class="ml-auto inline-block py-0.5 px-3 text-xs leading-4 rounded-full text-gray-600 bg-gray-200 group-hover:bg-gray-200 group-focus:bg-gray-300 transition ease-in-out duration-150">
						<%= tag.taggings_count %>
					</span>
				</div>
			
			<% end %>

		<% end %>

		<div class="mt-4 flex items-center flex-shrink-0 px-4 text-md leading-6 font-bold text-gray-900 dark:text-gray-200">
			<h3 class="font-bold">
				<%= t("conversations.menu.channels") %>
			</h3>
		</div>

		<% @app.conversation_channels.group("provider").count.each do |k, v| %>
			<%= link_to "a", data: { 
					controller: "attribute-clone", 
					clone_to: "#conversation_search_service_channel_id", 
					action: "click->attribute-clone#prevent" 
				}  do %>

				<%= radio_button_tag 'conversation_search_service[channel_id]', k, @search_service.channel_id == k,
					class: "hidden",
					id: "conversation_search_service_channel_id_#{k}" ,
					data: {
						attribute_clone_target: "radio"
					}
				%>

				<div class="navigator-item">
					<span class="truncate">
						<%= k %>
					</span>
					<span class="ml-auto inline-block py-0.5 px-3 text-xs leading-4 rounded-full text-gray-600 bg-gray-200 group-hover:bg-gray-200 group-focus:bg-gray-300 transition ease-in-out duration-150">
						<%= v %>
					</span>
				</div>
			
			<% end %>
		<% end %>

</div>
